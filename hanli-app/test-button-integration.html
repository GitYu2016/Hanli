<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>弹窗按钮集成测试</title>
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
    <link rel="stylesheet" href="renderer/styles.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--color-background-primary, #f5f5f5);
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        
        .test-description {
            color: #666;
            margin-bottom: 15px;
        }
        
        .test-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .modal-test {
            margin-top: 20px;
        }
        
        .more-menu-test {
            position: relative;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>弹窗按钮集成测试</h1>
        <p>此页面用于测试所有弹窗组件是否正确使用了Button.js中定义的按钮组件。</p>
        
        <!-- Button组件测试 -->
        <div class="test-section">
            <h2 class="test-title">Button组件基础测试</h2>
            <p class="test-description">测试Button组件的各种类型和尺寸</p>
            <div class="test-buttons" id="button-test-container">
                <!-- 按钮将通过JavaScript动态创建 -->
            </div>
        </div>
        
        <!-- SettingsModal测试 -->
        <div class="test-section">
            <h2 class="test-title">SettingsModal测试</h2>
            <p class="test-description">测试系统设置弹窗中的取消、保存、打开文件夹、清理缓存按钮</p>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="openSettingsModal()">打开设置弹窗</button>
            </div>
        </div>
        
        <!-- SearchModal测试 -->
        <div class="test-section">
            <h2 class="test-title">SearchModal测试</h2>
            <p class="test-description">测试搜索弹窗中的关闭按钮</p>
            <div class="test-buttons">
                <button class="btn btn-primary" onclick="openSearchModal()">打开搜索弹窗</button>
            </div>
        </div>
        
        <!-- MoreMenu测试 -->
        <div class="test-section">
            <h2 class="test-title">MoreMenu测试</h2>
            <p class="test-description">测试更多菜单中的触发按钮</p>
            <div class="test-buttons">
                <div class="more-menu-test" id="more-menu-test-container">
                    <!-- MoreMenu将通过JavaScript动态创建 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 引入必要的脚本 -->
    <script src="renderer/components/Common/Button.js"></script>
    <script src="renderer/components/Modal/SettingsModal.js"></script>
    <script src="renderer/components/Modal/SearchModal.js"></script>
    <script src="renderer/components/Modal/MoreMenu.js"></script>
    
    <script>
        // 模拟必要的全局对象
        window.keyboardShortcutManager = {
            register: () => {},
            unregister: () => {},
            unregisterContext: () => {},
            getShortcuts: () => []
        };
        
        // 创建Button组件测试
        function createButtonTests() {
            const container = document.getElementById('button-test-container');
            if (!container || !window.buttonInstance) return;
            
            // 创建各种类型的按钮
            const buttons = [
                { type: 'primary', text: '主要按钮', size: 'L' },
                { type: 'secondary', text: '次要按钮', size: 'M' },
                { type: 'success', text: '成功按钮', size: 'M' },
                { type: 'warning', text: '警告按钮', size: 'S' },
                { type: 'error', text: '错误按钮', size: 'S' }
            ];
            
            buttons.forEach(buttonConfig => {
                const button = window.buttonInstance.create({
                    ...buttonConfig,
                    onClick: () => console.log(`点击了${buttonConfig.text}`)
                });
                container.appendChild(button);
            });
        }
        
        // 创建SettingsModal实例
        let settingsModal;
        function initSettingsModal() {
            settingsModal = new SettingsModal();
            settingsModal.setCallbacks({
                onSave: (settings) => {
                    console.log('设置已保存:', settings);
                    alert('设置已保存！');
                },
                onCancel: () => {
                    console.log('设置已取消');
                }
            });
        }
        
        // 创建SearchModal实例
        let searchModal;
        function initSearchModal() {
            searchModal = new SearchModal();
            searchModal.setSearchCallback((query) => {
                console.log('搜索查询:', query);
                // 模拟搜索结果
                const mockResults = [
                    { id: '123456', title: '测试产品1', price: '99.00' },
                    { id: '789012', title: '测试产品2', price: '199.00' }
                ];
                searchModal.showResults(mockResults);
            });
        }
        
        // 创建MoreMenu实例
        let moreMenu;
        function initMoreMenu() {
            const container = document.getElementById('more-menu-test-container');
            if (!container) return;
            
            const menuItems = [
                { label: '编辑', action: 'edit', icon: 'pencil' },
                { label: '删除', action: 'delete', icon: 'trash' },
                { label: '复制', action: 'copy', icon: 'copy' },
                { label: '分享', action: 'share', icon: 'share' }
            ];
            
            moreMenu = new MoreMenu();
            moreMenu.init(container, menuItems);
            moreMenu.setMenuClickCallback((action, element) => {
                console.log('菜单项点击:', action);
                alert(`执行操作: ${action}`);
            });
        }
        
        // 打开设置弹窗
        function openSettingsModal() {
            if (settingsModal) {
                settingsModal.open();
            }
        }
        
        // 打开搜索弹窗
        function openSearchModal() {
            if (searchModal) {
                searchModal.open();
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('开始初始化弹窗按钮集成测试...');
            
            // 等待Button组件加载
            if (window.buttonInstance) {
                createButtonTests();
                initSettingsModal();
                initSearchModal();
                initMoreMenu();
                console.log('所有组件初始化完成！');
            } else {
                console.error('Button组件未加载，请检查Button.js文件');
            }
        });
    </script>
</body>
</html>
