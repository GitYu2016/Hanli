<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>双按钮悬浮测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.warning {
            background: #ffc107;
            color: #212529;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .product-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .product-info h3 {
            margin: 0 0 10px 0;
            color: #0066cc;
        }
        .product-info p {
            margin: 5px 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>双按钮悬浮测试</h1>
        
        <div class="product-info">
            <h3>模拟Temu商品页面</h3>
            <p><strong>商品ID:</strong> 601099514703283</p>
            <p><strong>商品名称:</strong> 测试商品</p>
            <p><strong>价格:</strong> $1.89</p>
            <p><strong>销量:</strong> 1054件</p>
            <p><strong>评分:</strong> 4.5</p>
            <p><strong>评价数:</strong> 128条</p>
            <p><strong>店铺名称:</strong> 测试店铺</p>
        </div>
        
        <div>
            <h3>测试操作</h3>
            <button class="btn" onclick="createFloatingButtons()">创建悬浮按钮</button>
            <button class="btn success" onclick="testCollectButton()">测试采集并监控</button>
            <button class="btn warning" onclick="testMonitorButton()">测试仅采集监控数据</button>
            <button class="btn" onclick="removeFloatingButtons()">移除悬浮按钮</button>
            <button class="btn" onclick="clearLog()">清空日志</button>
        </div>
        
        <div>
            <h3>测试日志</h3>
            <div class="log" id="test-log"></div>
        </div>
    </div>
    
    <script>
        // 模拟window.rawData
        window.rawData = {
            store: {
                goodsId: "601099514703283",
                goods: {
                    sideSalesTip: "1054件",
                    goodsName: "测试商品",
                    rating: "4.5",
                    reviewCount: 128
                },
                sku: [{
                    normalPriceStr: "$1.89"
                }],
                moduleMap: {
                    mallModule: {
                        data: {
                            mallData: {
                                mallId: "123456",
                                mallName: "测试店铺",
                                mallStar: "4.6",
                                goodsSalesNumUnit: ["600000", "件"],
                                followerNumUnit: ["1019", "人关注"],
                                goodsNumUnit: ["53", "个商品"]
                            }
                        }
                    }
                }
            }
        };

        let collectButton = null;
        let monitorButton = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const typeClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            logDiv.innerHTML += `<div class="log-entry"><span class="log-timestamp">[${timestamp}]</span> <span class="log-${typeClass}">${message}</span></div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function createFloatingButtons() {
            log('创建悬浮按钮...');
            
            // 创建按钮容器
            const buttonContainer = document.createElement('div');
            buttonContainer.id = 'hanli-button-container';
            buttonContainer.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                z-index: 10000;
                display: flex;
                gap: 12px;
                align-items: center;
            `;

            // 创建"采集并监控"按钮
            collectButton = document.createElement('div');
            collectButton.id = 'hanli-collect-btn';
            collectButton.innerHTML = '采集并监控';
            collectButton.style.cssText = `
                background: #000000;
                color: white;
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
                user-select: none;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                min-width: 120px;
            `;

            // 创建"仅采集监控数据"按钮
            monitorButton = document.createElement('div');
            monitorButton.id = 'hanli-monitor-btn';
            monitorButton.innerHTML = '仅采集监控数据';
            monitorButton.style.cssText = `
                background: #4a9eff;
                color: white;
                padding: 12px 24px;
                border-radius: 6px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                transition: all 0.3s ease;
                user-select: none;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                display: flex;
                align-items: center;
                justify-content: center;
                min-width: 140px;
            `;

            // 采集按钮悬停效果
            collectButton.addEventListener('mouseenter', () => {
                if (!collectButton.disabled) {
                    collectButton.style.background = '#333333';
                    collectButton.style.transform = 'translateY(-2px)';
                    collectButton.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.4)';
                }
            });

            collectButton.addEventListener('mouseleave', () => {
                if (!collectButton.disabled) {
                    collectButton.style.background = '#000000';
                    collectButton.style.transform = 'translateY(0)';
                    collectButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
                }
            });

            // 监控按钮悬停效果
            monitorButton.addEventListener('mouseenter', () => {
                if (!monitorButton.disabled) {
                    monitorButton.style.background = '#3a8eef';
                    monitorButton.style.transform = 'translateY(-2px)';
                    monitorButton.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.4)';
                }
            });

            monitorButton.addEventListener('mouseleave', () => {
                if (!monitorButton.disabled) {
                    monitorButton.style.background = '#4a9eff';
                    monitorButton.style.transform = 'translateY(0)';
                    monitorButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)';
                }
            });

            // 采集按钮点击事件
            collectButton.addEventListener('click', () => {
                log('采集并监控按钮被点击');
                updateCollectButtonStatus('collecting');
                setTimeout(() => {
                    updateCollectButtonStatus('completed');
                }, 2000);
            });

            // 监控按钮点击事件
            monitorButton.addEventListener('click', () => {
                log('仅采集监控数据按钮被点击');
                updateMonitorButtonStatus('collecting');
                setTimeout(() => {
                    updateMonitorButtonStatus('completed');
                }, 2000);
            });

            // 将按钮添加到容器
            buttonContainer.appendChild(collectButton);
            buttonContainer.appendChild(monitorButton);
            document.body.appendChild(buttonContainer);
            
            log('✅ 悬浮按钮已创建', 'success');
        }

        function updateCollectButtonStatus(status) {
            if (!collectButton) return;
            
            switch (status) {
                case 'collecting':
                    collectButton.innerHTML = '采集中...';
                    collectButton.style.background = '#666666';
                    collectButton.style.cursor = 'not-allowed';
                    collectButton.disabled = true;
                    log('采集按钮状态: 采集中');
                    break;
                case 'completed':
                    collectButton.innerHTML = '已采集';
                    collectButton.style.background = '#4caf50';
                    collectButton.style.cursor = 'default';
                    collectButton.disabled = true;
                    log('采集按钮状态: 已采集');
                    break;
                case 'ready':
                default:
                    collectButton.innerHTML = '采集并监控';
                    collectButton.style.background = '#000000';
                    collectButton.style.cursor = 'pointer';
                    collectButton.disabled = false;
                    log('采集按钮状态: 就绪');
                    break;
            }
        }

        function updateMonitorButtonStatus(status) {
            if (!monitorButton) return;
            
            switch (status) {
                case 'collecting':
                    monitorButton.innerHTML = '采集中...';
                    monitorButton.style.background = '#666666';
                    monitorButton.style.cursor = 'not-allowed';
                    monitorButton.disabled = true;
                    log('监控按钮状态: 采集中');
                    break;
                case 'completed':
                    monitorButton.innerHTML = '已采集';
                    monitorButton.style.background = '#4caf50';
                    monitorButton.style.cursor = 'default';
                    monitorButton.disabled = true;
                    log('监控按钮状态: 已采集');
                    // 2秒后恢复
                    setTimeout(() => {
                        updateMonitorButtonStatus('ready');
                    }, 2000);
                    break;
                case 'ready':
                default:
                    monitorButton.innerHTML = '仅采集监控数据';
                    monitorButton.style.background = '#4a9eff';
                    monitorButton.style.cursor = 'pointer';
                    monitorButton.disabled = false;
                    log('监控按钮状态: 就绪');
                    break;
            }
        }

        function testCollectButton() {
            if (!collectButton) {
                log('❌ 请先创建悬浮按钮', 'error');
                return;
            }
            log('测试采集并监控按钮...');
            collectButton.click();
        }

        function testMonitorButton() {
            if (!monitorButton) {
                log('❌ 请先创建悬浮按钮', 'error');
                return;
            }
            log('测试仅采集监控数据按钮...');
            monitorButton.click();
        }

        function removeFloatingButtons() {
            const buttonContainer = document.getElementById('hanli-button-container');
            if (buttonContainer) {
                buttonContainer.remove();
                collectButton = null;
                monitorButton = null;
                log('✅ 悬浮按钮已移除', 'success');
            } else {
                log('❌ 没有找到悬浮按钮', 'error');
            }
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('双按钮悬浮测试工具已加载');
            log('模拟了Temu商品页面的rawData');
        });
    </script>
</body>
</html>
