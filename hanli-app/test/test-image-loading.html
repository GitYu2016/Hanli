<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: http://localhost:3001 https://via.placeholder.com https://httpstat.us; font-src 'self' data:; connect-src 'self' http://localhost:3001;">
    <title>图片加载测试</title>
    <link rel="stylesheet" href="hanli-app/renderer/styles.css">
    <link rel="stylesheet" href="hanli-app/renderer/theme/light/colors.css">
    <link rel="stylesheet" href="hanli-app/renderer/icons-fixed.css">
</head>
<body>
    <div class="test-container" style="padding: 20px; max-width: 1200px; margin: 0 auto;">
        <h1>图片加载测试</h1>
        
        <div id="media-card-container"></div>
        
        <div style="margin-top: 20px;">
            <button onclick="testValidImage()">测试有效图片</button>
            <button onclick="testInvalidImage()">测试无效图片</button>
            <button onclick="testMixedImages()">测试混合图片</button>
        </div>
        
        <div id="console-log" style="margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;">
            控制台日志将显示在这里
        </div>
    </div>

    <script src="hanli-app/renderer/components/Detail/MediaCard.js"></script>
    <script>
        // 重写console.warn来捕获日志
        const originalWarn = console.warn;
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            const logDiv = document.getElementById('console-log');
            logDiv.innerHTML += args.join(' ') + '<br>';
            logDiv.scrollTop = logDiv.scrollHeight;
        };

        // 测试数据
        const validImages = [
            {
                type: 'image',
                url: 'https://via.placeholder.com/300x400/4CAF50/white?text=有效图片1',
                name: '有效图片1.jpg',
                width: 300,
                height: 400,
                fileSize: 1024000
            },
            {
                type: 'image',
                url: 'https://via.placeholder.com/400x300/2196F3/white?text=有效图片2',
                name: '有效图片2.png',
                width: 400,
                height: 300,
                fileSize: 2048000
            }
        ];

        const invalidImages = [
            {
                type: 'image',
                url: 'https://invalid-url-that-does-not-exist.com/image.jpg',
                name: '无效图片1.jpg',
                fileSize: 1024000
            },
            {
                type: 'image',
                url: 'https://httpstat.us/404',
                name: '无效图片2.jpg',
                fileSize: 1024000
            }
        ];

        const mixedImages = [
            {
                type: 'image',
                url: 'https://via.placeholder.com/300x400/4CAF50/white?text=有效图片',
                name: '有效图片.jpg',
                width: 300,
                height: 400,
                fileSize: 1024000
            },
            {
                type: 'image',
                url: 'https://invalid-url-that-does-not-exist.com/image.jpg',
                name: '无效图片.jpg',
                fileSize: 1024000
            }
        ];

        // 初始化媒体卡片组件
        function initMediaCard(mediaItems) {
            const container = document.getElementById('media-card-container');
            container.innerHTML = ''; // 清空容器
            
            if (typeof MediaCard !== 'undefined') {
                const mediaCard = new MediaCard();
                mediaCard.init(container, mediaItems, {
                    onSelectionChange: (selectedItems) => {
                        console.log('选择变化:', selectedItems.length, '个媒体项');
                    },
                    onImageClick: (image, index) => {
                        console.log('图片点击:', image.name);
                    },
                    onVideoContextMenu: (event, index, fileName, filePath) => {
                        console.log('视频右键菜单:', fileName);
                    }
                });
                window.testMediaCard = mediaCard;
            } else {
                container.innerHTML = '<div class="error">MediaCard组件未加载</div>';
            }
        }

        // 测试有效图片
        function testValidImage() {
            console.log('=== 测试有效图片 ===');
            initMediaCard(validImages);
        }

        // 测试无效图片
        function testInvalidImage() {
            console.log('=== 测试无效图片 ===');
            initMediaCard(invalidImages);
        }

        // 测试混合图片
        function testMixedImages() {
            console.log('=== 测试混合图片 ===');
            initMediaCard(mixedImages);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，可以开始测试');
        });
    </script>
</body>
</html>
