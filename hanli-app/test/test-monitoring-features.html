<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>监控功能完整测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .feature-section {
            margin: 30px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .feature-title {
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .btn {
            padding: 10px 20px;
            margin: 10px 5px;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: white;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn.success {
            background: #28a745;
        }
        .btn.warning {
            background: #ffc107;
            color: #212529;
        }
        .btn.info {
            background: #17a2b8;
        }
        .feature-list {
            list-style: none;
            padding: 0;
        }
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:before {
            content: "✅ ";
            color: #28a745;
            font-weight: bold;
        }
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-success {
            background: #28a745;
        }
        .status-warning {
            background: #ffc107;
        }
        .status-info {
            background: #17a2b8;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .card h3 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>监控功能完整测试</h1>
        <p>本页面用于测试和演示所有监控相关功能，包括插件采集、批量采集、悬浮按钮等。</p>
        
        <div class="feature-section">
            <h2 class="feature-title">1. 插件采集并监控</h2>
            <div class="grid">
                <div class="card">
                    <h3>功能说明</h3>
                    <ul class="feature-list">
                        <li>在Temu商品页面点击插件图标</li>
                        <li>选择"开始采集"执行完整采集流程</li>
                        <li>自动生成标准格式的monitoring.json数组</li>
                        <li>支持图片、视频、商品信息、监控数据全量采集</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 访问任意Temu商品页面</p>
                    <p>2. 点击浏览器插件图标</p>
                    <p>3. 点击"开始采集"按钮</p>
                    <p>4. 观察采集进度和结果</p>
                    <a href="https://www.temu.com" target="_blank" class="btn">访问Temu测试</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">2. 批量监控数据采集</h2>
            <div class="grid">
                <div class="card">
                    <h3>功能说明</h3>
                    <ul class="feature-list">
                        <li>页面自动加载商品清单和今日采集状态</li>
                        <li>智能检查每个商品的今日采集状态</li>
                        <li>已采集的商品显示"今日已采集"</li>
                        <li>支持单个商品手动采集</li>
                        <li>采集完成后自动刷新状态</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 点击插件"仅采集监控数据"按钮</p>
                    <p>2. 页面自动加载商品清单</p>
                    <p>3. 点击商品的"开始采集"按钮</p>
                    <p>4. 观察状态变化和自动刷新</p>
                    <button class="btn info" onclick="openMonitorCollection()">打开采集页面</button>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">3. 网页悬浮采集</h2>
            <div class="grid">
                <div class="card">
                    <h3>功能说明</h3>
                    <ul class="feature-list">
                        <li>在Temu商品页面底部显示两个悬浮按钮</li>
                        <li>"采集并监控"：执行完整的数据采集流程</li>
                        <li>"仅采集监控数据"：只采集监控数据，快速更新</li>
                        <li>按钮会根据系统主题自动调整颜色</li>
                        <li>采集期间按钮显示相应状态</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 访问Temu商品页面</p>
                    <p>2. 观察页面底部的悬浮按钮</p>
                    <p>3. 点击按钮测试采集功能</p>
                    <p>4. 切换系统主题观察按钮颜色变化</p>
                    <a href="https://www.temu.com" target="_blank" class="btn">测试悬浮按钮</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">4. 超时机制测试</h2>
            <div class="grid">
                <div class="card">
                    <h3>超时设置</h3>
                    <ul class="feature-list">
                        <li>超时时间：20秒</li>
                        <li>检查间隔：每3秒检查一次结果</li>
                        <li>日志显示：每3秒显示剩余时间</li>
                        <li>错误处理：超时后显示详细错误信息</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 打开超时机制测试页面</p>
                    <p>2. 测试正常采集（5秒完成）</p>
                    <p>3. 测试延迟采集（15秒完成）</p>
                    <p>4. 测试超时采集（25秒，会触发超时）</p>
                    <a href="test-timeout-mechanism.html" class="btn warning">测试超时机制</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">5. 主题适配测试</h2>
            <div class="grid">
                <div class="card">
                    <h3>主题功能</h3>
                    <ul class="feature-list">
                        <li>插件弹窗支持浅色/深色主题</li>
                        <li>悬浮按钮根据系统主题调整颜色</li>
                        <li>自动检测系统主题设置</li>
                        <li>平滑的主题切换动画</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 打开主题适配测试页面</p>
                    <p>2. 切换系统主题（浅色/深色模式）</p>
                    <p>3. 观察界面颜色变化</p>
                    <p>4. 测试按钮颜色适配</p>
                    <a href="test-theme-adaptation.html" class="btn info">测试主题适配</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">6. 数据格式验证</h2>
            <div class="grid">
                <div class="card">
                    <h3>数据格式要求</h3>
                    <div class="code-block">
{
  "id": "1758177484167",
  "utcTime": "2025-01-20T10:30:00+08:00",
  "goodsData": {
    "goodsSold": "1054件",
    "goodsPromoPrice": "¥1.89",
    "goodsTitle": "商品标题",
    "goodsRating": "4.5",
    "goodsReviews": "128条评价"
  },
  "storeData": {
    "storeSold": "600000件",
    "storeFollowers": "1019人关注",
    "storeItemsNum": "53个商品",
    "storeRating": "4.6",
    "storeName": "店铺名称"
  }
}
                    </div>
                </div>
                <div class="card">
                    <h3>验证要点</h3>
                    <ul class="feature-list">
                        <li>所有字段均为字符串类型</li>
                        <li>数值包含相应单位</li>
                        <li>时间使用东八区ISO格式</li>
                        <li>数组最多保存100条记录</li>
                    </ul>
                    <a href="test-monitoring-json-format.html" class="btn success">验证数据格式</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">7. API接口测试</h2>
            <div class="grid">
                <div class="card">
                    <h3>API端点</h3>
                    <ul class="feature-list">
                        <li>GET /api/monitor/get-products-list</li>
                        <li>GET /api/monitor/get-monitoring-data</li>
                        <li>POST /api/monitor/update-monitoring-data</li>
                        <li>POST /api/save-json-files</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>测试方法</h3>
                    <p>1. 确保Hanli App正在运行</p>
                    <p>2. 打开API测试页面</p>
                    <p>3. 测试各个API端点</p>
                    <p>4. 验证数据格式和响应</p>
                    <a href="test-products-list-api.html" class="btn info">测试API接口</a>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">8. 状态管理测试</h2>
            <div class="grid">
                <div class="card">
                    <h3>状态类型</h3>
                    <ul class="feature-list">
                        <li><span class="status-indicator status-warning"></span>等待采集</li>
                        <li><span class="status-indicator status-info"></span>采集中</li>
                        <li><span class="status-indicator status-success"></span>今日已采集</li>
                        <li><span class="status-indicator status-warning"></span>采集失败</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>自动刷新机制</h3>
                    <ul class="feature-list">
                        <li>监听localStorage更新事件</li>
                        <li>监听postMessage消息</li>
                        <li>定期检查状态（每30秒）</li>
                        <li>采集完成后自动触发刷新</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="feature-section">
            <h2 class="feature-title">9. 测试总结</h2>
            <div class="grid">
                <div class="card">
                    <h3>核心功能</h3>
                    <ul class="feature-list">
                        <li>插件采集并监控 ✅</li>
                        <li>批量监控数据采集 ✅</li>
                        <li>网页悬浮采集 ✅</li>
                        <li>今日状态检查 ✅</li>
                        <li>自动刷新机制 ✅</li>
                        <li>主题适配支持 ✅</li>
                        <li>超时保护机制 ✅</li>
                    </ul>
                </div>
                <div class="card">
                    <h3>技术特性</h3>
                    <ul class="feature-list">
                        <li>20秒超时，3秒检查间隔</li>
                        <li>支持localStorage和postMessage通信</li>
                        <li>标准数组格式的monitoring.json</li>
                        <li>字符串类型数据，包含单位</li>
                        <li>东八区时间格式</li>
                        <li>最多100条历史记录</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openMonitorCollection() {
            // 模拟打开监控数据采集页面
            const url = chrome.runtime ? chrome.runtime.getURL('monitor-collection.html') : 'monitor-collection.html';
            window.open(url, '_blank');
        }

        // 页面加载完成后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('监控功能完整测试页面已加载');
            
            // 检查是否在Chrome扩展环境中
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                console.log('检测到Chrome扩展环境');
            } else {
                console.log('在普通浏览器环境中运行');
            }
        });
    </script>
</body>
</html>
