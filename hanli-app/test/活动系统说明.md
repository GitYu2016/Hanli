# 活动系统功能说明

## 概述
实现了首页"最近活动"功能，显示真实的数据而不是模拟数据。系统会监控`goods-library`文件夹的变化，并自动记录相关活动。

## 功能特性

### 1. 文件系统监控
- 使用`chokidar`库监控`hanli-app/data/goods-library`目录
- 实时检测文件夹的添加、删除和文件变化
- 自动记录各种类型的活动

### 2. 活动类型
- `product_added`: 添加了产品（检测到包含product.json的文件夹）
- `product_updated`: 更新了产品信息
- `folder_added`: 添加了文件夹
- `folder_removed`: 删除了文件夹
- `monitoring_updated`: 更新了监控数据
- `media_updated`: 更新了媒体数据
- `system`: 系统活动（手动添加）

### 3. 数据存储
- 活动记录存储在`hanli-app/data/activity.json`文件中
- 使用东八区时间格式：`"utcTime": "2024-09-07T00:00:00"`
- 自动限制最多保存100条记录
- 时间最近的记录在数组前面

### 4. API接口

#### 获取最近活动
```
GET /api/activities/recent
```
返回最近5条活动记录

#### 获取所有活动
```
GET /api/activities?page=1&limit=20
```
支持分页查询

#### 添加活动
```
POST /api/activities
Content-Type: application/json

{
    "type": "system",
    "title": "测试活动",
    "details": {
        "test": true
    }
}
```

### 5. 前端功能
- 首页显示最近5条活动
- 每30秒自动刷新活动列表
- 支持多种活动类型的图标显示
- 时间格式化显示（刚刚、几分钟前、几小时前等）
- 测试按钮用于手动添加活动

## 文件结构

```
hanli-app/
├── data/
│   ├── activity.json          # 活动记录存储文件
│   └── goods-library/         # 被监控的产品库目录
├── server.js                  # 服务器端文件监控和API
└── renderer/
    └── pages/
        └── HomePage.js        # 首页组件
```

## 使用方法

### 1. 启动应用
```bash
cd hanli-app
npm start
```

### 2. 测试功能
1. 在首页点击"测试活动"按钮添加测试记录
2. 在`goods-library`目录中添加或删除文件夹
3. 修改产品JSON文件观察活动记录

### 3. 查看活动记录
- 首页"最近活动"区域显示最新5条记录
- 使用测试页面`test-activity-system.html`查看完整记录

## 技术实现

### 文件监控
```javascript
const chokidar = require('chokidar');
const fileWatcher = chokidar.watch(goodsLibraryPath, {
    ignored: /(^|[\/\\])\../,
    persistent: true,
    ignoreInitial: true,
    depth: 1
});
```

### 活动记录结构
```javascript
{
    "id": "123456789012",
    "type": "product_added",
    "title": "添加了产品: 产品名称",
    "details": {
        "goodsId": "601099514703283",
        "productTitle": "产品名称"
    },
    "time": "2024-09-07T08:30:00.000Z",
    "utcTime": "2024-09-07T08:30:00.000Z"
}
```

## 注意事项

1. 文件监控只在服务器启动时开始工作
2. 活动记录按时间倒序排列（最新的在前）
3. 系统会自动限制活动记录数量，避免文件过大
4. 所有时间都使用东八区时间格式
5. 监控只检测一级目录的变化，不会递归监控子目录

## 测试页面

打开`test-activity-system.html`可以测试所有API功能：
- 添加测试活动
- 查看活动列表
- 查看最近活动
