<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>拖拽区域测试</title>
    <link rel="stylesheet" href="../renderer/styles.css">
    <link rel="stylesheet" href="../renderer/icons-fixed.css">
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-background);
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--color-text-primary);
        }
        
        .test-description {
            color: var(--color-text-secondary);
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .drag-test-area {
            border: 2px dashed var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            background-color: var(--color-hover);
        }
        
        .no-drag-test-area {
            border: 2px solid var(--color-border);
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            background-color: var(--color-card-background);
        }
        
        .test-btn {
            padding: 10px 20px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 5px;
        }
        
        .test-btn:hover {
            background-color: var(--color-hover);
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success {
            background-color: #28ca42;
        }
        
        .status-warning {
            background-color: #ffbd2e;
        }
        
        .status-error {
            background-color: #ff5f57;
        }
        
        .log-area {
            background-color: var(--color-hover);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-success {
            color: #28ca42;
        }
        
        .log-warning {
            color: #ffbd2e;
        }
        
        .log-error {
            color: #ff5f57;
        }
        
        .log-info {
            color: var(--color-text-secondary);
        }
        
        /* 模拟完整的应用布局 */
        .mock-app {
            height: 400px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .mock-home-page {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        
        .mock-top-bar {
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background-color: var(--color-muted);
            border-bottom: 1px solid var(--color-border);
        }
        
        .mock-main-layout {
            flex: 1;
            display: flex;
        }
        
        .mock-sidebar {
            width: 200px;
            background-color: var(--color-hover);
            border-right: 1px solid var(--color-border);
            padding: 16px;
        }
        
        .mock-page-container {
            flex: 1;
            background-color: var(--color-page-container-background);
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>拖拽区域测试</h1>
        
        <!-- 拖拽区域说明 -->
        <div class="test-section">
            <div class="test-title">拖拽区域说明</div>
            <div class="test-description">
                在自定义窗口控制的Electron应用中，需要正确设置拖拽区域：
                <ul>
                    <li><strong>可拖拽区域</strong>：只有顶部栏应该支持拖拽移动窗口</li>
                    <li><strong>不可拖拽区域</strong>：所有可交互元素（按钮、链接、输入框等）应该设置为不可拖拽</li>
                </ul>
            </div>
        </div>
        
        <!-- 测试区域 -->
        <div class="test-section">
            <div class="test-title">拖拽功能测试</div>
            <div class="test-description">
                测试不同区域的拖拽行为
            </div>
            
            <div class="drag-test-area">
                <h3>可拖拽区域（顶部栏）</h3>
                <p>这个区域应该可以拖拽移动窗口</p>
                <div class="mock-top-bar">
                    <div>Logo</div>
                    <div>Tabs</div>
                    <div>Settings</div>
                </div>
            </div>
            
            <div class="no-drag-test-area">
                <h3>不可拖拽区域（内容区域）</h3>
                <p>这个区域应该不能拖拽移动窗口</p>
                <button class="test-btn">测试按钮</button>
                <button class="test-btn">另一个按钮</button>
                <p>点击这些按钮应该不会移动窗口</p>
            </div>
        </div>
        
        <!-- 完整布局测试 -->
        <div class="test-section">
            <div class="test-title">完整布局测试</div>
            <div class="test-description">
                模拟完整的应用布局，测试拖拽区域是否正确设置
            </div>
            
            <div class="mock-app">
                <div class="mock-home-page">
                    <div class="mock-top-bar">
                        <div>Hanli</div>
                        <div>Tab区域</div>
                        <div>设置</div>
                    </div>
                    <div class="mock-main-layout">
                        <div class="mock-sidebar">
                            <h4>侧边栏</h4>
                            <p>产品库</p>
                        </div>
                        <div class="mock-page-container">
                            <h4>页面内容</h4>
                            <p>这里是页面内容，不应该支持拖拽</p>
                            <button class="test-btn">页面按钮</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 功能测试 -->
        <div class="test-section">
            <div class="test-title">功能测试</div>
            <div class="test-description">
                测试拖拽功能是否正确工作
            </div>
            
            <button class="test-btn" onclick="testDragRegions()">测试拖拽区域</button>
            <button class="test-btn" onclick="testInteractiveElements()">测试交互元素</button>
            <button class="test-btn" onclick="clearLog()">清除日志</button>
        </div>
        
        <!-- 日志区域 -->
        <div class="test-section">
            <div class="test-title">测试日志</div>
            <div id="test-log" class="log-area">
                <div class="log-entry log-info">测试日志将显示在这里...</div>
            </div>
        </div>
    </div>

    <script>
        let logEntries = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push({ message: entry, type });
            
            const logArea = document.getElementById('test-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = entry;
            logArea.appendChild(logEntry);
            
            // 滚动到底部
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            logEntries = [];
            log('日志已清除', 'info');
        }
        
        function testDragRegions() {
            log('开始测试拖拽区域...', 'info');
            
            // 检查body的拖拽设置
            const bodyStyle = window.getComputedStyle(document.body);
            log(`body -webkit-app-region: ${bodyStyle.webkitAppRegion || '未设置'}`, 'info');
            
            // 检查顶部栏的拖拽设置
            const topBar = document.querySelector('.mock-top-bar');
            if (topBar) {
                const topBarStyle = window.getComputedStyle(topBar);
                log(`顶部栏 -webkit-app-region: ${topBarStyle.webkitAppRegion || '未设置'}`, 'info');
                
                if (topBarStyle.webkitAppRegion === 'drag') {
                    log('✅ 顶部栏设置为可拖拽', 'success');
                } else {
                    log('❌ 顶部栏未设置为可拖拽', 'error');
                }
            }
            
            // 检查按钮的拖拽设置
            const buttons = document.querySelectorAll('.test-btn');
            buttons.forEach((button, index) => {
                const buttonStyle = window.getComputedStyle(button);
                log(`按钮 ${index + 1} -webkit-app-region: ${buttonStyle.webkitAppRegion || '未设置'}`, 'info');
                
                if (buttonStyle.webkitAppRegion === 'no-drag') {
                    log(`✅ 按钮 ${index + 1} 设置为不可拖拽`, 'success');
                } else {
                    log(`❌ 按钮 ${index + 1} 未设置为不可拖拽`, 'error');
                }
            });
        }
        
        function testInteractiveElements() {
            log('开始测试交互元素...', 'info');
            
            const interactiveElements = [
                'button', 'input', 'select', 'textarea', 'a', 
                '.tab', '.sidebar-item', '.settings-icon', 
                '.top-bar-tabs', '.tab-icon', '.tab-text', '.tab-close'
            ];
            
            interactiveElements.forEach(selector => {
                const elements = document.querySelectorAll(selector);
                if (elements.length > 0) {
                    elements.forEach((element, index) => {
                        const style = window.getComputedStyle(element);
                        const appRegion = style.webkitAppRegion || '未设置';
                        
                        if (appRegion === 'no-drag') {
                            log(`✅ ${selector} ${index + 1} 设置为不可拖拽`, 'success');
                        } else {
                            log(`⚠️ ${selector} ${index + 1} -webkit-app-region: ${appRegion}`, 'warning');
                        }
                    });
                } else {
                    log(`ℹ️ 未找到 ${selector} 元素`, 'info');
                }
            });
        }
        
        // 页面加载完成后自动测试
        document.addEventListener('DOMContentLoaded', () => {
            log('页面加载完成，开始自动测试...', 'info');
            setTimeout(() => {
                testDragRegions();
                testInteractiveElements();
            }, 1000);
        });
        
        // 添加点击事件监听器，测试交互元素
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('test-btn')) {
                log(`点击了按钮: ${e.target.textContent}`, 'info');
            }
        });
    </script>
</body>
</html>
