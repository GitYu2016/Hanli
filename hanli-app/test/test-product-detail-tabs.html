<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品详情Tab测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
        }
        .success {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>产品详情Tab系统测试</h1>
    
    <div class="test-section">
        <h2>测试说明</h2>
        <p>这个测试页面用于验证产品详情Tab系统的新功能：</p>
        <ul>
            <li>✅ 打开产品A详情，创建Tab A</li>
            <li>✅ 打开产品B详情，创建Tab B（而不是替换Tab A）</li>
            <li>✅ 点击Tab A，显示产品A详情</li>
            <li>✅ 点击Tab B，显示产品B详情</li>
            <li>✅ 每个产品详情都有独立的Tab</li>
        </ul>
    </div>

    <div class="test-section">
        <h2>模拟测试</h2>
        <p>点击下面的按钮来模拟打开不同产品的详情页：</p>
        
        <button class="test-button" onclick="simulateOpenProduct('601099563571188')">
            打开产品A (601099563571188)
        </button>
        
        <button class="test-button" onclick="simulateOpenProduct('601099715250032')">
            打开产品B (601099715250032)
        </button>
        
        <button class="test-button" onclick="simulateOpenProduct('601100385710256')">
            打开产品C (601100385710256)
        </button>
        
        <button class="test-button" onclick="checkTabStatus()">
            检查Tab状态
        </button>
        
        <div id="test-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>Tab系统改进</h2>
        <h3>新增功能：</h3>
        <ul>
            <li><strong>findTabByPageTypeAndParam()</strong> - 根据页面类型和参数查找Tab</li>
            <li><strong>产品详情Tab区分</strong> - 每个产品详情都有独立的Tab</li>
            <li><strong>Tab切换数据加载</strong> - 切换Tab时自动重新加载对应产品数据</li>
        </ul>
        
        <h3>修改的方法：</h3>
        <ul>
            <li><strong>TabManager.findTabByPageTypeAndParam()</strong> - 新增方法</li>
            <li><strong>HomePage.openProductDetailTab()</strong> - 使用新的查找逻辑</li>
            <li><strong>HomePage.handleTabSwitch()</strong> - 传递pageData参数</li>
            <li><strong>HomePage.renderPageContent()</strong> - 支持产品详情页重新加载</li>
            <li><strong>HomePage.loadProductDetailByGoodsId()</strong> - 新增方法</li>
        </ul>
    </div>

    <script>
        // 模拟Tab管理
        let mockTabs = [];
        let tabIdCounter = 0;

        function generateTabId() {
            return `tab_${++tabIdCounter}`;
        }

        function findTabByPageTypeAndParam(pageType, paramKey, paramValue) {
            return mockTabs.find(tab => 
                tab.pageType === pageType && 
                tab.pageData && 
                tab.pageData[paramKey] === paramValue
            );
        }

        function simulateOpenProduct(goodsId) {
            const existingTab = findTabByPageTypeAndParam('productDetail', 'productId', goodsId);
            
            if (existingTab) {
                updateResult(`产品 ${goodsId} 的Tab已存在，切换到该Tab`, 'success');
            } else {
                const tabId = generateTabId();
                const tab = {
                    id: tabId,
                    pageType: 'productDetail',
                    title: `产品详情 - ${goodsId}`,
                    pageData: {
                        type: 'productDetail',
                        title: `产品详情 - ${goodsId}`,
                        productId: goodsId
                    },
                    isActive: true
                };
                
                // 取消其他Tab的激活状态
                mockTabs.forEach(t => t.isActive = false);
                
                mockTabs.push(tab);
                updateResult(`创建新的产品详情Tab: ${goodsId}`, 'success');
            }
            
            checkTabStatus();
        }

        function checkTabStatus() {
            const resultDiv = document.getElementById('test-result');
            let html = '<h3>当前Tab状态：</h3>';
            
            if (mockTabs.length === 0) {
                html += '<p>暂无Tab</p>';
            } else {
                html += '<ul>';
                mockTabs.forEach(tab => {
                    const status = tab.isActive ? '（激活）' : '';
                    html += `<li>${tab.title} - ID: ${tab.pageData.productId} ${status}</li>`;
                });
                html += '</ul>';
            }
            
            resultDiv.innerHTML = html;
        }

        function updateResult(message, type = '') {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }

        // 初始化
        checkTabStatus();
    </script>
</body>
</html>
