<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>窗口控制按钮隐藏测试</title>
    <link rel="stylesheet" href="../renderer/styles.css">
    <link rel="stylesheet" href="../renderer/icons-fixed.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid var(--color-border);
            border-radius: 8px;
            background-color: var(--color-background);
        }
        
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--color-text-primary);
        }
        
        .test-description {
            color: var(--color-text-secondary);
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .config-info {
            background-color: var(--color-hover);
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-success {
            background-color: #28ca42;
        }
        
        .status-warning {
            background-color: #ffbd2e;
        }
        
        .status-error {
            background-color: #ff5f57;
        }
        
        .button-test {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .test-btn {
            padding: 10px 20px;
            border: 1px solid var(--color-border);
            border-radius: 6px;
            background-color: var(--color-background);
            color: var(--color-text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background-color: var(--color-hover);
        }
        
        .log-area {
            background-color: var(--color-hover);
            border: 1px solid var(--color-border);
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 2px 0;
        }
        
        .log-success {
            color: #28ca42;
        }
        
        .log-warning {
            color: #ffbd2e;
        }
        
        .log-error {
            color: #ff5f57;
        }
        
        .log-info {
            color: var(--color-text-secondary);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>窗口控制按钮隐藏测试</h1>
        
        <!-- 当前配置检查 -->
        <div class="test-section">
            <div class="test-title">当前窗口配置</div>
            <div class="test-description">
                检查当前Electron窗口的配置是否正确隐藏了原生窗口控制按钮
            </div>
            
            <div class="config-info">
                <div><strong>frame:</strong> false</div>
                <div><strong>titleBarStyle:</strong> 'hidden'</div>
                <div><strong>trafficLightPosition:</strong> { x: -1000, y: -1000 }</div>
            </div>
            
            <div id="config-status">
                <div class="log-entry log-info">正在检查配置...</div>
            </div>
        </div>
        
        <!-- 原生按钮检查 -->
        <div class="test-section">
            <div class="test-title">原生窗口控制按钮检查</div>
            <div class="test-description">
                检查是否还能看到macOS原生的红绿灯按钮（红色关闭、黄色最小化、绿色最大化）
            </div>
            
            <div id="native-buttons-status">
                <div class="log-entry log-info">请检查窗口左上角是否还有原生的三个按钮...</div>
            </div>
            
            <div class="button-test">
                <button class="test-btn" onclick="checkNativeButtons()">检查原生按钮</button>
                <button class="test-btn" onclick="clearLog()">清除日志</button>
            </div>
        </div>
        
        <!-- 自定义按钮测试 -->
        <div class="test-section">
            <div class="test-title">自定义窗口控制按钮测试</div>
            <div class="test-description">
                测试我们的自定义窗口控制按钮是否正常工作
            </div>
            
            <div class="button-test">
                <button class="test-btn" onclick="testCustomButtons()">测试自定义按钮</button>
                <button class="test-btn" onclick="testButtonVisibility()">检查按钮可见性</button>
            </div>
        </div>
        
        <!-- 日志区域 -->
        <div class="test-section">
            <div class="test-title">测试日志</div>
            <div id="test-log" class="log-area">
                <div class="log-entry log-info">测试日志将显示在这里...</div>
            </div>
        </div>
    </div>

    <script>
        let logEntries = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            logEntries.push({ message: entry, type });
            
            const logArea = document.getElementById('test-log');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = entry;
            logArea.appendChild(logEntry);
            
            // 滚动到底部
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
            logEntries = [];
            log('日志已清除', 'info');
        }
        
        function checkNativeButtons() {
            log('开始检查原生窗口控制按钮...', 'info');
            
            // 检查窗口配置
            if (window.electronAPI) {
                log('✅ electronAPI 可用', 'success');
                
                // 尝试获取平台信息
                if (window.electronAPI.getPlatform) {
                    window.electronAPI.getPlatform().then(platform => {
                        log(`当前平台: ${platform}`, 'info');
                        
                        if (platform === 'darwin') {
                            log('✅ 检测到 macOS 平台', 'success');
                            log('请手动检查窗口左上角是否还有原生的红绿灯按钮', 'warning');
                            log('如果还有原生按钮，说明配置未生效', 'error');
                            log('如果原生按钮已隐藏，说明配置成功', 'success');
                        } else {
                            log(`非 macOS 平台 (${platform})，原生按钮样式可能不同`, 'warning');
                        }
                    });
                } else {
                    log('⚠️ getPlatform API 不可用', 'warning');
                }
            } else {
                log('❌ electronAPI 不可用', 'error');
            }
        }
        
        function testCustomButtons() {
            log('开始测试自定义窗口控制按钮...', 'info');
            
            // 检查自定义按钮是否存在
            const closeBtn = document.getElementById('close-btn');
            const minimizeBtn = document.getElementById('minimize-btn');
            const maximizeBtn = document.getElementById('maximize-btn');
            
            if (closeBtn) {
                log('✅ 关闭按钮元素存在', 'success');
            } else {
                log('❌ 关闭按钮元素不存在', 'error');
            }
            
            if (minimizeBtn) {
                log('✅ 最小化按钮元素存在', 'success');
            } else {
                log('❌ 最小化按钮元素不存在', 'error');
            }
            
            if (maximizeBtn) {
                log('✅ 最大化按钮元素存在', 'success');
            } else {
                log('❌ 最大化按钮元素不存在', 'error');
            }
            
            // 检查API是否可用
            if (window.electronAPI && window.electronAPI.windowAPI) {
                log('✅ windowAPI 可用', 'success');
                
                // 测试API调用（不实际执行）
                log('测试 API 调用路径...', 'info');
                log('关闭: window.electronAPI.windowAPI.close()', 'info');
                log('最小化: window.electronAPI.windowAPI.minimize()', 'info');
                log('最大化: window.electronAPI.windowAPI.maximize()', 'info');
            } else {
                log('❌ windowAPI 不可用', 'error');
            }
        }
        
        function testButtonVisibility() {
            log('检查自定义按钮可见性...', 'info');
            
            const windowControls = document.querySelector('.window-controls');
            if (windowControls) {
                const rect = windowControls.getBoundingClientRect();
                log(`自定义按钮位置: top=${rect.top}px, left=${rect.left}px`, 'info');
                log(`自定义按钮大小: width=${rect.width}px, height=${rect.height}px`, 'info');
                
                const computedStyle = window.getComputedStyle(windowControls);
                log(`自定义按钮显示状态: display=${computedStyle.display}, visibility=${computedStyle.visibility}`, 'info');
                
                if (computedStyle.display !== 'none' && computedStyle.visibility !== 'hidden') {
                    log('✅ 自定义按钮可见', 'success');
                } else {
                    log('❌ 自定义按钮不可见', 'error');
                }
            } else {
                log('❌ 找不到 .window-controls 元素', 'error');
            }
        }
        
        // 页面加载完成后自动检查
        document.addEventListener('DOMContentLoaded', () => {
            log('页面加载完成，开始自动检查...', 'info');
            setTimeout(() => {
                checkNativeButtons();
                testCustomButtons();
            }, 1000);
        });
    </script>
</body>
</html>
