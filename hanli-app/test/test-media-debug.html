<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: blob: http://localhost:3001 https://via.placeholder.com https://httpstat.us; font-src 'self' data:; connect-src 'self' http://localhost:3001;">
    <title>媒体卡片调试测试</title>
    <link rel="stylesheet" href="hanli-app/renderer/styles.css">
    <link rel="stylesheet" href="hanli-app/renderer/theme/light/colors.css">
    <link rel="stylesheet" href="hanli-app/renderer/icons-fixed.css">
</head>
<body>
    <div class="test-container" style="padding: 20px; max-width: 1200px; margin: 0 auto;">
        <h1>媒体卡片调试测试</h1>
        
        <div style="margin-bottom: 20px;">
            <button onclick="testValidImages()">测试有效图片</button>
            <button onclick="testInvalidImages()">测试无效图片</button>
            <button onclick="testEmptyArray()">测试空数组</button>
            <button onclick="testUndefinedArray()">测试undefined数组</button>
            <button onclick="clearLogs()">清除日志</button>
        </div>
        
        <div id="media-card-container"></div>
        
        <div id="debug-log" style="margin-top: 20px; padding: 10px; background: #f5f5f5; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; white-space: pre-wrap;">
            调试日志将显示在这里...
        </div>
    </div>

    <script src="hanli-app/renderer/components/Detail/MediaCard.js"></script>
    <script>
        // 重写console.log和console.warn来捕获日志
        const originalLog = console.log;
        const originalWarn = console.warn;
        
        function addToLog(message, type = 'log') {
            const logDiv = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'warn' ? '[WARN]' : '[LOG]';
            logDiv.textContent += `${timestamp} ${prefix} ${message}\n`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addToLog(args.join(' '), 'log');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addToLog(args.join(' '), 'warn');
        };

        // 测试数据
        const validImages = [
            {
                type: 'image',
                url: 'https://via.placeholder.com/300x400/4CAF50/white?text=有效图片1',
                name: '有效图片1.jpg',
                width: 300,
                height: 400,
                fileSize: 1024000
            },
            {
                type: 'image',
                url: 'https://via.placeholder.com/400x300/2196F3/white?text=有效图片2',
                name: '有效图片2.png',
                width: 400,
                height: 300,
                fileSize: 2048000
            }
        ];

        const invalidImages = [
            {
                type: 'image',
                url: 'https://invalid-url-that-does-not-exist.com/image1.jpg',
                name: '无效图片1.jpg',
                fileSize: 1024000
            },
            {
                type: 'image',
                url: 'https://httpstat.us/404',
                name: '无效图片2.jpg',
                fileSize: 1024000
            }
        ];

        // 初始化媒体卡片组件
        function initMediaCard(mediaItems, testName) {
            console.log(`=== 开始测试: ${testName} ===`);
            console.log('传入的mediaItems:', mediaItems);
            
            const container = document.getElementById('media-card-container');
            container.innerHTML = ''; // 清空容器
            
            if (typeof MediaCard !== 'undefined') {
                const mediaCard = new MediaCard();
                console.log('MediaCard组件已创建');
                
                mediaCard.init(container, mediaItems, {
                    onSelectionChange: (selectedItems) => {
                        console.log('选择变化:', selectedItems.length, '个媒体项');
                    },
                    onImageClick: (image, index) => {
                        console.log('图片点击:', image.name, '索引:', index);
                    },
                    onVideoContextMenu: (event, index, fileName, filePath) => {
                        console.log('视频右键菜单:', fileName, '索引:', index);
                    }
                });
                
                console.log('MediaCard组件初始化完成');
                window.testMediaCard = mediaCard;
            } else {
                console.error('MediaCard组件未加载');
                container.innerHTML = '<div class="error">MediaCard组件未加载</div>';
            }
        }

        // 测试有效图片
        function testValidImages() {
            initMediaCard(validImages, '有效图片测试');
        }

        // 测试无效图片
        function testInvalidImages() {
            initMediaCard(invalidImages, '无效图片测试');
        }

        // 测试空数组
        function testEmptyArray() {
            initMediaCard([], '空数组测试');
        }

        // 测试undefined数组
        function testUndefinedArray() {
            initMediaCard(undefined, 'undefined数组测试');
        }

        // 清除日志
        function clearLogs() {
            document.getElementById('debug-log').textContent = '调试日志已清除...\n';
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            console.log('页面加载完成，可以开始测试');
            console.log('MediaCard组件是否可用:', typeof MediaCard !== 'undefined');
        });
    </script>
</body>
</html>
