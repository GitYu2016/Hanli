# 项目结构文档

## 整体项目结构

```
hanli-master/
├── Docs/                          # 项目文档
│   ├── 一、通用/                  # 通用文档
│   │   ├── UI规范.md
│   │   ├── 代码规范.md
│   │   ├── 倒角标准.md
│   │   ├── 技术框架.md
│   │   └── 项目结构.md
│   ├── 二、组件/                  # 组件文档
│   │   ├── PageContainer.md
│   │   ├── SideBar.md
│   │   ├── Tab功能实现.md
│   │   ├── Tab功能快速参考.md
│   │   ├── TopBar.md
│   │   └── TopBarTabs.md
│   ├── 三、采集与监控/            # 采集监控文档
│   │   ├── 监控.md
│   │   ├── 采集.md
│   │   ├── 采集字段说明.md
│   │   └── 采集给到App.md
│   └── 四、产品库列表/            # 产品库文档
│       └── 产品库列表.md
├── hanli-app/                     # Electron桌面应用
│   ├── main.js                    # 主进程入口文件
│   ├── preload.js                 # 预加载脚本
│   ├── server.js                  # 本地服务器
│   ├── debug-app.js               # 调试应用脚本
│   ├── package.json               # 应用配置和依赖
│   ├── package-lock.json          # 依赖锁定文件
│   ├── data/                      # 数据目录
│   │   └── goods-library/         # 商品库数据
│   ├── dist/                      # 构建输出目录
│   │   ├── builder-debug.yml      # 调试构建配置
│   │   ├── builder-effective-config.yaml # 有效构建配置
│   │   └── mac-arm64/             # Mac ARM64构建包
│   │       └── Hanli.app/         # 应用包
│   ├── node_modules/              # 依赖包目录
│   ├── test/                      # 测试文件目录
│   │   ├── index.html             # 测试首页
│   │   ├── open-tests.sh          # 测试启动脚本
│   │   ├── README.md              # 测试说明
│   │   ├── test-*.html            # 各种测试页面
│   │   └── verify-app-name.js     # 应用名称验证脚本
│   └── renderer/                  # 渲染进程(前端代码)
│       ├── index.html             # 主页面
│       ├── app.js                 # 主应用逻辑
│       ├── styles.css             # 全局样式
│       ├── icons-fixed.css        # 图标样式
│       ├── components/            # 组件目录
│       │   ├── Common/            # 通用组件
│       │   │   ├── TopBar.js      # 顶部导航栏
│       │   │   ├── SideBar.js     # 侧边栏
│       │   │   └── PageContainer.js # 页面容器
│       │   ├── Detail/            # 详情页组件
│       │   │   ├── AttachmentCard.js # 附件卡片
│       │   │   └── ProductCharts.js # 产品图表
│       │   ├── Image/             # 图片相关组件(空目录)
│       │   └── Modal/             # 弹窗组件
│       │       └── SettingsModal.js # 设置弹窗
│       ├── pages/                 # 页面组件
│       │   ├── HomePage.js        # 首页
│       │   ├── ProductDetail.js   # 产品详情页
│       │   └── ProductLibrary.js  # 产品库页面
│       └── theme/                 # 主题样式
│           ├── light/             # 浅色主题
│           │   └── colors.css
│           └── dark/              # 深色主题
│               └── colors.css
├── hanli-plugin/                  # Chrome插件
│   ├── manifest.json              # 插件配置文件
│   ├── background.js              # 后台脚本
│   ├── content.js                 # 内容脚本
│   ├── main.js                    # 主入口文件
│   ├── popup.html                 # 弹窗页面
│   ├── popup.js                   # 弹窗逻辑
│   ├── dataCollector.js           # 数据采集器
│   ├── imageCollector.js          # 图片采集器
│   ├── videoCollector.js          # 视频采集器
│   ├── collectionManager.js       # 采集管理器
│   ├── mediaManager.js            # 媒体管理器
│   ├── debug-fetch.js             # 调试获取脚本
│   ├── icon.svg                   # 插件SVG图标
│   ├── package.json               # 插件依赖配置
│   ├── README-CollectionProgress.md # 采集进度说明
│   ├── components/                # 插件组件
│   │   └── CollectionProgressDialog.js # 采集进度对话框
│   └── icons/                     # 插件图标
│       ├── icon16.png
│       ├── icon32.png
│       ├── icon48.png
│       └── icon128.png
├── check-protocol.sh              # 协议检查脚本
├── plugin-flow-diagram.md         # 插件流程图文档
└── test-*.html                    # 根目录测试文件(已迁移到hanli-app/test/)
```

## 详细目录说明

### 1. Docs/ - 项目文档
- **一、通用/**: 通用文档
  - UI规范、代码规范、倒角标准、技术框架、项目结构等
- **二、组件/**: 组件相关文档
  - PageContainer、SideBar、TopBar、Tab功能等组件说明
- **三、采集与监控/**: 采集监控文档
  - 监控、采集、采集字段说明、采集给到App等
- **四、产品库列表/**: 产品库文档
  - 产品库列表相关说明

### 2. hanli-app/ - Electron桌面应用

#### 2.1 根目录文件
- **main.js**: Electron主进程入口，负责创建窗口、处理系统事件
- **preload.js**: 预加载脚本，提供安全的API给渲染进程
- **server.js**: 本地服务器，提供API接口
- **debug-app.js**: 调试应用脚本
- **package.json**: 应用配置、依赖管理、脚本命令
- **package-lock.json**: 依赖锁定文件，确保依赖版本一致性

#### 2.2 数据目录
- **data/**: 数据存储目录
  - **goods-library/**: 商品库数据文件

#### 2.3 构建输出目录
- **dist/**: 构建输出目录
  - **builder-debug.yml**: 调试构建配置
  - **builder-effective-config.yaml**: 有效构建配置
  - **mac-arm64/**: Mac ARM64构建包
    - **Hanli.app/**: 应用包

#### 2.4 测试目录
- **test/**: 测试文件目录
  - **index.html**: 测试首页
  - **open-tests.sh**: 测试启动脚本
  - **README.md**: 测试说明文档
  - **test-*.html**: 各种功能测试页面
  - **verify-app-name.js**: 应用名称验证脚本

#### 2.5 renderer/ - 渲染进程(前端)
- **index.html**: 主页面HTML结构
- **app.js**: 主应用逻辑，负责页面初始化和路由管理
- **styles.css**: 全局样式文件
- **icons-fixed.css**: 图标样式文件

#### 2.6 renderer/components/ - 组件系统
- **Common/**: 通用组件
  - `TopBar.js`: 顶部导航栏组件
  - `SideBar.js`: 侧边栏组件
  - `PageContainer.js`: 页面容器组件

- **Detail/**: 详情页组件
  - `AttachmentCard.js`: 附件卡片组件
  - `ProductCharts.js`: 产品图表组件

- **Image/**: 图片相关组件(空目录，预留)

- **Modal/**: 弹窗组件
  - `SettingsModal.js`: 设置弹窗

#### 2.7 renderer/pages/ - 页面组件
- **HomePage.js**: 首页组件
- **ProductDetail.js**: 产品详情页组件
- **ProductLibrary.js**: 产品库页面组件

#### 2.8 renderer/theme/ - 主题系统
- **light/**: 浅色主题样式
  - `colors.css`: 浅色主题颜色定义
- **dark/**: 深色主题样式
  - `colors.css`: 深色主题颜色定义

### 3. hanli-plugin/ - Chrome插件

#### 3.1 核心文件
- **manifest.json**: 插件配置文件，定义权限和入口
- **background.js**: 后台脚本，处理插件生命周期
- **content.js**: 内容脚本，注入到网页中
- **main.js**: 主入口文件
- **popup.html**: 插件弹窗界面
- **popup.js**: 插件弹窗逻辑

#### 3.2 功能模块
- **dataCollector.js**: 通用数据采集器
- **imageCollector.js**: 图片数据采集
- **videoCollector.js**: 视频数据采集
- **collectionManager.js**: 采集管理器
- **mediaManager.js**: 媒体管理器
- **debug-fetch.js**: 调试获取脚本

#### 3.3 组件目录
- **components/**: 插件组件
  - `CollectionProgressDialog.js`: 采集进度对话框

#### 3.4 资源文件
- **icon.svg**: 插件SVG图标
- **icons/**: 插件图标文件(16x16, 32x32, 48x48, 128x128)
- **README-CollectionProgress.md**: 采集进度说明文档

### 4. 根目录文件
- **check-protocol.sh**: 协议检查脚本
- **plugin-flow-diagram.md**: 插件流程图文档
- **test-*.html**: 根目录测试文件(已迁移到hanli-app/test/)

## 文件命名规范

### JavaScript文件
- 使用驼峰命名法: `ImageManager.js`
- 组件文件以功能命名: `TopBar.js`, `SideBar.js`
- 管理器文件以Manager结尾: `DataManager.js`

### CSS文件
- 使用连字符命名: `styles.css`, `colors.css`
- 主题文件放在对应主题目录下

### HTML文件
- 使用连字符命名: `index.html`, `popup.html`

## 组件开发规范

### 1. 组件结构
每个组件都是独立的HTML文件，包含：
- HTML结构
- CSS样式
- JavaScript逻辑

### 2. 组件目录
- 按功能分类放在不同子目录
- 弹窗组件统一放在 `Modal/` 目录
- 通用组件放在 `Common/` 目录

### 3. 样式隔离
- 使用CSS类名和ID进行样式隔离
- 主要div元素需要添加id或class名称(使用缩写)

## 数据流架构

```
用户操作 → 组件事件 → 数据管理器 → 本地存储/数据库
    ↓
UI更新 ← 状态变化 ← 事件系统 ← 数据变化
```

## Tab功能架构

### Tab功能流程
```
Tab点击 → TopBar.switchTab() → TabManager.onTabSwitch() → 触发tabSwitch事件 → HomePage.handleTabSwitch() → 渲染页面内容
```

### Tab相关组件
- **TabManager**: Tab状态管理类，负责Tab的增删改查
- **TopBar**: Tab UI渲染组件，负责Tab的显示和交互
- **HomePage**: 主应用类，负责Tab切换后的页面内容渲染

### Tab事件系统
- **自定义事件**: `tabSwitch` - Tab切换时触发
- **事件监听**: 主应用监听Tab切换事件并处理页面渲染
- **事件数据**: `{ tab: Tab对象 }`

### Tab类型支持
| 类型 | 说明 | 图标 | 数据来源 |
|------|------|------|----------|
| home | 首页 | `ph-house` | 静态数据 |
| goodsList | 产品库 | `ph-package` | API数据 |
| productDetail | 产品详情 | `ph-info` | API数据 |

### Tab功能特性
- **动态创建**: 支持根据页面类型动态创建Tab
- **状态管理**: 维护Tab的激活状态和页面数据
- **事件驱动**: 使用自定义事件实现组件间通信
- **键盘支持**: 支持Ctrl+W关闭、Ctrl+Tab切换等快捷键
- **动画效果**: 支持Tab关闭动画和悬停效果
- **内存管理**: 自动清理事件监听器，避免内存泄漏

## 开发工作流

1. **组件开发**: 在 `renderer/components/` 下创建新组件
2. **样式开发**: 在对应主题目录下添加样式
3. **功能集成**: 在 `app.js` 中集成组件
4. **测试调试**: 使用Electron开发模式测试
5. **打包发布**: 使用electron-builder打包

## 注意事项

- 所有组件都应该是独立的，便于维护和复用
- 弹窗组件必须放在 `renderer/components/Modal/` 目录
- 遵循项目的命名规范和代码规范
- 保持代码的可读性和可维护性