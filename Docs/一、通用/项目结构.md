# 项目结构文档

## 整体项目结构

```
hanli-master/
├── Docs/                          # 项目文档
│   ├── 一、通用/                  # 通用文档
│   │   ├── UI规范.md
│   │   ├── 代码规范.md
│   │   ├── 技术框架.md
│   │   ├── 项目结构.md
│   │   └── LoggerManager.md       # 日志管理器文档
│   ├── 二、组件/                  # 组件文档
│   │   ├── ImagesCard.md
│   │   ├── MediaCard.md
│   │   ├── MediaCard拖拽复制功能.md
│   │   ├── SideBar.md
│   │   ├── Tab功能完整文档.md
│   │   ├── TopBar.md
│   │   └── TopBarTabs.md
│   ├── 三、采集与监控/            # 采集监控文档
│   │   ├── plugin-flow-diagram.md
│   │   ├── 媒体文件去重机制.md
│   │   ├── 数据格式规范.md
│   │   ├── 监控.md
│   │   ├── 采集.md
│   │   ├── 采集字段说明.md
│   │   └── 采集给到App.md
│   └── 四、产品库列表/            # 产品库文档
│       └── 产品库列表.md
├── hanli-app/                     # Electron桌面应用
│   ├── main.js                    # 主进程入口文件
│   ├── preload.js                 # 预加载脚本
│   ├── server.js                  # 本地服务器
│   ├── debug-app.js               # 调试应用脚本
│   ├── package.json               # 应用配置和依赖
│   ├── package-lock.json          # 依赖锁定文件
│   ├── data/                      # 数据目录
│   │   └── goods-library/         # 商品库数据
│   ├── dist/                      # 构建输出目录
│   │   ├── builder-debug.yml      # 调试构建配置
│   │   ├── builder-effective-config.yaml # 有效构建配置
│   │   └── mac-arm64/             # Mac ARM64构建包
│   │       └── Hanli.app/         # 应用包
│   ├── node_modules/              # 依赖包目录
│   ├── test/                      # 测试文件目录
│   │   ├── index.html             # 测试首页
│   │   ├── open-tests.sh          # 测试启动脚本
│   │   ├── README.md              # 测试说明
│   │   ├── test-*.html            # 各种测试页面
│   │   └── verify-app-name.js     # 应用名称验证脚本
│   └── renderer/                  # 渲染进程(前端代码)
│       ├── index.html             # 主页面
│       ├── app.js                 # 主应用逻辑
│       ├── globals.css             # 全局样式
│       ├── icons-fixed.css        # 图标样式（已废弃，使用Icon.js）
│       ├── components/            # 组件目录
│       │   ├── Common/            # 通用组件
│       │   │   ├── TopBar.js      # 顶部导航栏
│       │   │   ├── SideBar.js     # 侧边栏
│       │   │   └── PageContainer.js # 页面容器
│       │   ├── Detail/            # 详情页组件
│       │   │   ├── AttachmentCard.js # 附件卡片
│       │   │   └── ProductCharts.js # 产品图表
│       │   ├── Image/             # 图片相关组件(空目录)
│       │   └── Modal/             # 弹窗组件
│       │       └── SettingsModal.js # 设置弹窗
│       ├── pages/                 # 页面组件
│       │   ├── HomePage.js        # 首页
│       │   ├── ProductDetail.js   # 产品详情页
│       │   └── ProductLibrary.js  # 产品库页面
│       └── theme/                 # 主题样式
│           ├── light/             # 浅色主题
│           │   └── colors.css
│           └── dark/              # 深色主题
│               └── colors.css
├── hanli-plugin/                  # Chrome插件
│   ├── manifest.json              # 插件配置文件
│   ├── background.js              # 后台脚本
│   ├── content.js                 # 内容脚本
│   ├── main.js                    # 主入口文件
│   ├── popup.html                 # 弹窗页面
│   ├── popup.js                   # 弹窗逻辑
│   ├── dataCollector.js           # 数据采集器
│   ├── imageCollector.js          # 图片采集器
│   ├── videoCollector.js          # 视频采集器
│   ├── collectionManager.js       # 采集管理器
│   ├── mediaManager.js            # 媒体管理器
│   ├── debug-fetch.js             # 调试获取脚本
│   ├── enhanced-monitor-collection.js # 增强监控采集脚本
│   ├── monitor-collection.html    # 监控采集页面
│   ├── monitor-collection.js      # 监控采集脚本
│   ├── icon.svg                   # 插件SVG图标
│   ├── package.json               # 插件依赖配置
│   ├── README-CollectionProgress.md # 采集进度说明
│   ├── components/                # 插件组件
│   │   └── CollectionProgressDialog.js # 采集进度对话框
│   └── icons/                     # 插件图标
│       ├── icon16.png
│       ├── icon32.png
│       ├── icon48.png
│       └── icon128.png
├── hanli-n8n/                     # N8N工作流项目
│   ├── package.json               # N8N项目依赖配置
│   ├── package-lock.json          # 依赖锁定文件
│   └── node_modules/              # 依赖包目录
├── check-protocol.sh              # 协议检查脚本
├── plugin-flow-diagram.md         # 插件流程图文档
└── test-*.html                    # 根目录测试文件(已迁移到hanli-app/test/)
```

## 详细目录说明

### 1. Docs/ - 项目文档
- **一、通用/**: 通用文档
  - UI规范、代码规范、倒角标准、技术框架、项目结构等
- **二、组件/**: 组件相关文档
  - PageContainer、SideBar、TopBar、Tab功能等组件说明
- **三、采集与监控/**: 采集监控文档
  - 监控、采集、采集字段说明、采集给到App等
- **四、产品库列表/**: 产品库文档
  - 产品库列表相关说明

### 2. hanli-app/ - Electron桌面应用

#### 2.1 根目录文件
- **main.js**: Electron主进程入口，负责创建窗口、处理系统事件
- **preload.js**: 预加载脚本，提供安全的API给渲染进程
- **server.js**: 本地服务器，提供API接口
- **debug-app.js**: 调试应用脚本
- **package.json**: 应用配置、依赖管理、脚本命令
- **package-lock.json**: 依赖锁定文件，确保依赖版本一致性

#### 2.2 数据目录
- **data/**: 数据存储目录
  - **goods-library/**: 商品库数据文件

#### 2.3 构建输出目录
- **dist/**: 构建输出目录
  - **builder-debug.yml**: 调试构建配置
  - **builder-effective-config.yaml**: 有效构建配置
  - **mac-arm64/**: Mac ARM64构建包
    - **Hanli.app/**: 应用包

#### 2.4 测试目录
- **test/**: 测试文件目录
  - **index.html**: 测试首页
  - **open-tests.sh**: 测试启动脚本
  - **README.md**: 测试说明文档
  - **verify-app-name.js**: 应用名称验证脚本
  - **enhanced-test.html**: 增强测试页面
  - **range-selection-test.html**: 范围选择测试
  - **test-product-library-styles.html**: 产品库样式测试
  - **test-theme-selector.html**: 主题选择器测试
  - **test-button-integration.html**: 按钮集成测试
  - **components/**: 组件测试目录
    - **test-attachment-card.html**: 附件卡片测试
    - **test-button-component.html**: 按钮组件测试
    - **test-chart-display.html**: 图表显示测试
    - **test-chart-theme.html**: 图表主题测试
    - **test-color-system.html**: 颜色系统测试
    - **test-css-to-js.html**: CSS转JS测试
    - **test-icons-showcase.html**: 图标展示测试
    - **test-json-preview.html**: JSON预览测试
    - **test-media-card.html**: 媒体卡片测试
    - **test-pagination-component.html**: 分页组件测试
    - **test-product-more-menu.html**: 产品更多菜单测试
    - **test-search-modal.html**: 搜索弹窗测试
    - **test-topbar-tabs.html**: 顶部标签页测试
  - **features/**: 功能测试目录
  - **system/**: 系统测试目录
    - **test-activity-system.html**: 活动系统测试
    - **test-collection-system.html**: 采集系统测试
    - **test-trash-functionality.html**: 废纸篓功能测试
    - **test-window-size.html**: 窗口大小测试

#### 2.5 renderer/ - 渲染进程(前端)
- **index.html**: 主页面HTML结构
- **app.js**: 主应用逻辑，负责页面初始化和路由管理
- **config.js**: 应用配置文件
- **refresh-styles.js**: 样式刷新脚本
- **globals.css**: 全局样式文件
- **styles.js**: 样式管理脚本
- **icons-fixed.css**: 图标样式文件（已废弃，使用Icon.js）
- **icons/**: 图标资源目录

#### 2.6 renderer/components/ - 组件系统
- **Common/**: 通用组件
  - `BaseComponent.js`: 基础组件类，提供通用功能和样式管理
  - `Button.js`: 按钮组件，支持多种尺寸和类型
  - `Icon.js`: 图标组件，使用Phosphor Icons本地化方案
  - `KeyboardShortcutManager.js`: 键盘快捷键管理器
  - `LoggerManager.js`: 日志管理器，提供统一的日志记录和管理功能
  - `PageContainer.js`: 页面容器组件
  - `Pagination.js`: 分页组件
  - `SideBar.js`: 侧边栏组件
  - `StyleManager.js`: 样式管理器，用于JavaScript中定义CSS
  - `Switch.js`: 开关组件
  - `ThemeSelector.js`: 主题选择器组件
  - `ThemeManager.js`: 主题管理器
  - `Toast.js`: 通知提示组件
  - `TopBar.js`: 顶部导航栏组件
  - `TopBarTabs.js`: 顶部标签页组件
  - `TabManager.js`: 标签页管理器
  - `BackgroundColorSelector.js`: 背景色选择器

- **HomePage/**: 首页组件
  - `HomePage.js`: 主页面组件

- **Modal/**: 弹窗组件
  - `JsonPreviewIntegration.js`: JSON预览集成组件
  - `JsonPreviewModal.js`: JSON预览弹窗
  - `JsonPreviewModalExample.js`: JSON预览示例
  - `MoreMenu.js`: 更多菜单组件
  - `MoreMenuFixed.js`: 固定更多菜单组件
  - `ProductMoreMenu.js`: 产品更多菜单组件
  - `SearchModal.js`: 搜索弹窗组件
  - `SettingsModal.js`: 设置弹窗组件

- **ProductDetailPage/**: 产品详情页组件
  - `AttachmentCard.js`: 附件卡片组件
  - `MediaCard.js`: 媒体卡片组件，支持图片和视频
  - `MediaSelection.js`: 媒体选择组件
  - `ProductCharts.js`: 产品图表组件
  - `ProductDetail.js`: 产品详情组件
  - `ProductInfoCard.js`: 产品信息卡片组件

- **ProductLibraryPage/**: 产品库页面组件
  - `ProductLibrary.js`: 产品库组件
  - `ProductDataManager.js`: 产品数据管理器

#### 2.7 renderer/assets/ - 资源文件
- **svgs/**: SVG图标资源
  - **bold/**: 粗体图标（1512个文件）
  - **fill/**: 填充图标（1512个文件）
  - **regular/**: 常规图标（1512个文件）

#### 2.8 renderer/theme/ - 主题系统
- **light/**: 浅色主题样式
  - `colors.css`: 浅色主题颜色定义
- **dark/**: 深色主题样式
  - `colors.css`: 深色主题颜色定义

### 3. hanli-plugin/ - Chrome插件

#### 3.1 核心文件
- **manifest.json**: 插件配置文件，定义权限和入口
- **background.js**: 后台脚本，处理插件生命周期
- **content.js**: 内容脚本，注入到网页中
- **main.js**: 主入口文件
- **popup.html**: 插件弹窗界面
- **popup.js**: 插件弹窗逻辑

#### 3.2 功能模块
- **dataCollector.js**: 通用数据采集器
- **imageCollector.js**: 图片数据采集
- **videoCollector.js**: 视频数据采集
- **collectionManager.js**: 采集管理器
- **mediaManager.js**: 媒体管理器
- **debug-fetch.js**: 调试获取脚本
- **enhanced-monitor-collection.js**: 增强监控采集脚本
- **monitor-collection.html**: 监控采集页面
- **monitor-collection.js**: 监控采集脚本

#### 3.3 组件目录
- **components/**: 插件组件
  - `CollectionProgressDialog.js`: 采集进度对话框

#### 3.4 资源文件
- **icon.svg**: 插件SVG图标
- **icons/**: 插件图标文件(16x16, 32x32, 48x48, 128x128)
- **README-CollectionProgress.md**: 采集进度说明文档

### 4. hanli-n8n/ - N8N工作流项目

#### 4.1 项目概述
- **hanli-n8n**: 基于N8N的工作流自动化项目
- 用于处理数据采集、处理和分发的自动化流程

#### 4.2 核心文件
- **package.json**: N8N项目依赖配置和脚本
- **package-lock.json**: 依赖锁定文件，确保依赖版本一致性
- **node_modules/**: 依赖包目录

### 5. 根目录文件
- **check-protocol.sh**: 协议检查脚本
- **plugin-flow-diagram.md**: 插件流程图文档
- **test-*.html**: 根目录测试文件(已迁移到hanli-app/test/)

## 文件命名规范

### JavaScript文件
- 使用驼峰命名法: `ImageManager.js`
- 组件文件以功能命名: `TopBar.js`, `SideBar.js`
- 管理器文件以Manager结尾: `DataManager.js`

### CSS文件
- 使用连字符命名: `globals.css`, `colors.css`
- 主题文件放在对应主题目录下

### HTML文件
- 使用连字符命名: `index.html`, `popup.html`

## 组件开发规范

### 1. 组件结构
每个组件都是独立的JavaScript文件，包含：
- 组件类定义
- 样式定义（通过StyleManager管理）
- 事件绑定和交互逻辑
- 生命周期管理

### 2. 组件目录
- **Common/**: 通用组件，如Button、Toast、Pagination等
- **Modal/**: 弹窗组件，如SearchModal、SettingsModal等
- **ProductDetailPage/**: 产品详情页相关组件
- **ProductLibraryPage/**: 产品库页面相关组件
- **HomePage/**: 首页相关组件

### 3. 样式管理
- 使用StyleManager统一管理组件样式
- 样式定义在JavaScript中，通过CSS-in-JS方式实现
- 支持主题切换和响应式设计
- 使用CSS变量实现主题适配
- 基于Radix颜色令牌的层次化颜色系统
- 支持多种背景色主题变体

### 4. 组件特性
- **Button组件**: 支持L、M、S三种尺寸，primary、secondary、success、warning、error五种类型
- **Toast组件**: 支持success、error、info、warning四种类型通知
- **MediaCard组件**: 支持图片和视频的加载、显示、选择、拖拽复制功能
- **SearchModal组件**: 提供产品搜索功能，支持键盘快捷键
- **Pagination组件**: 提供分页功能，支持跳转和响应式设计

## 数据流架构

```
用户操作 → 组件事件 → 数据管理器 → 本地存储/数据库
    ↓
UI更新 ← 状态变化 ← 事件系统 ← 数据变化
```

## Tab功能架构

### Tab功能流程
```
Tab点击 → TopBar.switchTab() → TabManager.onTabSwitch() → 触发tabSwitch事件 → HomePage.handleTabSwitch() → 渲染页面内容
```

### Tab相关组件
- **TabManager**: Tab状态管理类，负责Tab的增删改查
- **TopBar**: Tab UI渲染组件，负责Tab的显示和交互
- **HomePage**: 主应用类，负责Tab切换后的页面内容渲染

### Tab事件系统
- **自定义事件**: `tabSwitch` - Tab切换时触发
- **事件监听**: 主应用监听Tab切换事件并处理页面渲染
- **事件数据**: `{ tab: Tab对象 }`

### Tab类型支持
| 类型 | 说明 | 图标 | 数据来源 |
|------|------|------|----------|
| home | 首页 | `ph-house` | 静态数据 |
| goodsList | 产品库 | `ph-package` | API数据 |
| productDetail | 产品详情 | `ph-info` | API数据 |

### Tab功能特性
- **动态创建**: 支持根据页面类型动态创建Tab
- **状态管理**: 维护Tab的激活状态和页面数据
- **事件驱动**: 使用自定义事件实现组件间通信
- **键盘支持**: 支持Ctrl+W关闭、Ctrl+Tab切换等快捷键
- **动画效果**: 支持Tab关闭动画和悬停效果
- **内存管理**: 自动清理事件监听器，避免内存泄漏

## 开发工作流

1. **组件开发**: 在 `renderer/components/` 下创建新组件
   - 使用StyleManager管理样式
   - 遵循组件开发规范
   - 添加完整的JSDoc注释

2. **样式开发**: 通过StyleManager在JavaScript中定义样式
   - 支持主题变量
   - 响应式设计
   - 动画效果

3. **功能集成**: 在 `app.js` 中集成组件
   - 注册全局实例
   - 绑定事件监听器
   - 管理组件生命周期

4. **测试调试**: 使用测试页面验证组件功能
   - 在 `test/components/` 下创建测试页面
   - 使用Electron开发模式测试
   - 验证不同主题下的显示效果

5. **打包发布**: 使用electron-builder打包
   - 构建Mac ARM64版本
   - 生成DMG安装包
   - 代码签名和公证

## 注意事项

- 所有组件都应该是独立的，便于维护和复用
- 弹窗组件必须放在 `renderer/components/Modal/` 目录
- 遵循项目的命名规范和代码规范
- 保持代码的可读性和可维护性
- 使用StyleManager统一管理样式，避免样式冲突
- 组件必须支持主题切换和响应式设计
- 添加完整的JSDoc注释和错误处理
- 测试组件在不同主题和屏幕尺寸下的表现
- 遵循项目的图标系统规范，使用Phosphor Icons
- 确保组件的可访问性和键盘导航支持