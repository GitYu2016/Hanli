# 代码规范文档

## 1. 图标系统规范

### 1.1 图标颜色规范
- **实现方式**：使用CSS Mask技术，通过`background-color`控制颜色
- **颜色变量**：使用语义化CSS变量控制图标颜色
- **透明度标准**：统一使用`opacity: 0.8` (80%) 透明度
- **主题适配**：自动适配浅色/深色主题
- **状态变化**：支持hover、active、disabled等状态

### 1.2 图标实现规范
- **图标库**：使用Phosphor Icons本地化方案
- **文件位置**：`renderer/components/Common/Icon.js`
- **实现方式**：
  - 使用本地SVG文件
  - 通过CSS类名控制颜色和样式
  - 使用`color`属性控制颜色
  - 支持多种图标样式（regular、bold、fill）
- **CSS属性**：使用`color`和`opacity`实现主题适配

### 1.3 图标CSS变量定义
```css
/* 图标颜色变量 - 使用语义化变量 */
:root {
    --color-primary: rgba(0, 0, 0, 0.8);     /* 主要图标 */
    --color-secondary: rgba(0, 0, 0, 0.5);   /* 次要图标 */
    --color-focused: rgba(0, 0, 0, 1.0);     /* 悬停/激活图标 */
    --color-disabled: rgba(0, 0, 0, 0.3);    /* 禁用图标 */
}

.theme-dark {
    --color-primary: rgba(255, 255, 255, 0.8);     /* 主要图标 */
    --color-secondary: rgba(255, 255, 255, 0.5);   /* 次要图标 */
    --color-focused: rgba(255, 255, 255, 1.0);     /* 悬停/激活图标 */
    --color-disabled: rgba(255, 255, 255, 0.3);    /* 禁用图标 */
}
```

### 1.4 图标使用示例
```javascript
// 正确的图标使用方式
Icon.render('house', { className: 'svg-icon', style: 'bold' })
Icon.render('package', { className: 'svg-icon', style: 'regular' })
Icon.render('gear', { className: 'svg-icon', style: 'fill' })
```

### 1.5 新增图标规范
当需要新增图标时，必须遵循以下规范：
1. 使用Phosphor Icons的设计风格
2. 在 `Icon.js` 的 `iconMap` 中添加图标映射
3. 确保SVG文件存在于 `renderer/assets/svgs/` 目录下
4. 保持与其他图标一致的透明度和样式
5. 支持regular、bold、fill三种样式

## 2. 数据格式规范

### 2.1 监控数据格式规范 (2025-01-27更新)
- **数值类型统一**：monitoring.json中所有数值字段必须使用数字类型
- **价格转换**：美元价格自动转换为人民币数值（汇率7.0）
- **单位处理**：移除所有单位后缀（"件"、"人关注"、"个商品"等）
- **数据一致性**：完整采集和仅采集监控数据使用相同的数据格式
- **API接口**：通过 `http://localhost:3001/api/products/{id}/monitoring` 获取监控数据

#### 2.1.1 字段类型规范
```json
{
  "goodsData": {
    "goodsSold": 1138,           // 数字类型
    "goodsPromoPrice": 99.47,    // 数字类型（人民币）
    "goodsRating": 0,            // 数字类型
    "goodsReviews": 0            // 数字类型
  },
  "storeData": {
    "storeSold": 4827,           // 数字类型
    "storeFollowers": 17,        // 数字类型
    "storeItemsNum": 14,         // 数字类型
    "storeRating": 4.9           // 数字类型
  }
}
```

#### 2.1.2 价格转换规则
- **输入格式**：`"$1.99"` 或 `"$10.50"`
- **转换规则**：美元价格 × 7.0 = 人民币价格
- **输出格式**：`13.93` 或 `73.5`（数字类型）

#### 2.1.3 单位处理规则
- **销量**：`"1138件"` → `1138`
- **粉丝数**：`"17人关注"` → `17`
- **商品数**：`"14个商品"` → `14`
- **评价数**：`"0条评价"` → `0`

## 3. 颜色使用规范

### 3.1 半透明色规范（核心规范）
- **强制使用半透明色**：所有颜色必须使用半透明色（RGBA格式）
- **禁止纯色**：禁止使用纯色（如 `#ffffff`、`#000000`）
- **透明度标准**：
  - 浅色主题：使用白色半透明 `rgba(255, 255, 255, 0.95)`
  - 深色主题：使用黑色半透明 `rgba(0, 0, 0, 0.95)`
  - 彩色背景：使用8%-12%透明度
- **背景色规范**：
  - 浅色主题背景色：`rgba(颜色, 0.08)`
  - 深色主题背景色：`rgba(颜色, 0.12)`
  - 页面容器背景：比主背景色透明度高4%

### 2.2 RGBA颜色优先
- **优先使用RGBA**：在需要透明度的场景下，优先使用RGBA颜色值
- **避免十六进制+opacity**：不使用 `#666666` + `opacity: 0.8` 的组合
- **直接透明度**：在颜色值中直接包含透明度信息

### 2.3 颜色命名规范
- **CSS变量命名**：使用语义化命名，如 `--icon-color`
- **颜色值格式**：统一使用RGBA格式，如 `rgba(102, 102, 102, 0.8)`
- **主题适配**：通过CSS变量实现主题切换

### 2.4 半透明色使用示例
```css
/* 正确的半透明色定义 */
:root {
    /* 基础背景色 - 浅色主题 */
    --color-background: rgba(255, 255, 255, 0.95);
    --color-page-container-background: rgba(255, 255, 255, 0.8);
    
    /* 彩色背景色 - 浅色主题 */
    --color-bg-blue: rgba(59, 130, 246, 0.08);
    --color-bg-green: rgba(34, 197, 94, 0.08);
    --color-bg-purple: rgba(147, 51, 234, 0.08);
    
    /* 图标颜色 */
    --icon-color: rgba(102, 102, 102, 0.8);
}

.theme-dark {
    /* 基础背景色 - 深色主题 */
    --color-background: rgba(0, 0, 0, 0.95);
    --color-page-container-background: rgba(0, 0, 0, 0.8);
    
    /* 彩色背景色 - 深色主题 */
    --color-bg-blue: rgba(59, 130, 246, 0.12);
    --color-bg-green: rgba(34, 197, 94, 0.12);
    --color-bg-purple: rgba(147, 51, 234, 0.12);
    
    /* 图标颜色 */
    --icon-color: rgba(255, 255, 255, 0.8);
}

/* 背景色主题类 */
.bg-blue {
    --color-background: rgba(59, 130, 246, 0.08);
    --color-page-container-background: rgba(59, 130, 246, 0.12);
}

.theme-dark .bg-blue {
    --color-background: rgba(59, 130, 246, 0.12);
    --color-page-container-background: rgba(59, 130, 246, 0.16);
}
```

### 2.5 禁止的颜色使用
```css
/* ❌ 错误：使用纯色 */
--color-background: #ffffff;
--color-background: #000000;

/* ❌ 错误：使用十六进制+opacity */
--color-background: #f0f9ff;
opacity: 0.8;

/* ✅ 正确：使用半透明色 */
--color-background: rgba(240, 249, 255, 0.8);
```

## 3. CSS编写规范

### 3.1 变量使用
- **统一变量**：所有颜色使用CSS变量定义
- **主题适配**：通过变量实现主题切换
- **语义化命名**：变量名具有明确的语义

### 3.2 样式组织
- **文件分离**：图标样式独立文件管理
- **模块化**：按功能模块组织CSS代码
- **注释规范**：关键样式添加中文注释
- **CSS-in-JS**：组件样式通过StyleManager在JavaScript中管理

### 3.3 性能优化
- **避免滤镜**：不使用CSS滤镜属性
- **直接颜色**：直接设置颜色值，避免计算
- **本地SVG**：使用本地SVG文件减少HTTP请求
- **按需加载**：组件样式按需注入到页面中

## 4. 维护规范

### 4.1 图标维护
- **版本控制**：图标文件纳入版本控制
- **一致性检查**：定期检查图标颜色一致性
- **文档更新**：图标变更时更新相关文档

### 4.2 代码审查
- **颜色检查**：审查时检查是否使用RGBA格式
- **变量使用**：确保使用CSS变量而非硬编码颜色
- **主题适配**：验证主题切换功能正常

## 5. 注意事项

### 5.1 半透明色特殊注意事项
- **背景叠加**：半透明色会与底层背景叠加，需要考虑视觉效果
- **对比度**：确保半透明背景上的文字有足够的对比度
- **层级管理**：合理使用z-index管理半透明元素的层级关系
- **性能影响**：半透明色可能影响渲染性能，避免过度使用

### 5.2 兼容性
- **浏览器支持**：确保RGBA颜色在目标浏览器中正常显示
- **降级方案**：为不支持RGBA的浏览器提供降级方案
- **透明度支持**：检查目标浏览器的透明度支持情况

### 5.3 性能考虑
- **文件大小**：控制图标CSS文件大小
- **加载优化**：优化图标加载性能
- **缓存策略**：合理设置图标文件缓存
- **渲染性能**：半透明色可能增加GPU负担

### 5.4 开发效率
- **工具支持**：使用合适的开发工具
- **自动化**：考虑图标生成的自动化流程
- **文档维护**：保持文档与代码同步
- **颜色工具**：使用支持RGBA的颜色选择工具
