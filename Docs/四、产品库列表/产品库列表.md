# 产品库列表

## 功能概述

产品库列表页面用于展示所有已采集的产品信息，提供实时数据更新和交互浏览功能。

## 界面设计

### 列表显示字段

1. **产品标题** (goodsCat3)
   - 显示产品的完整标题
   - 支持悬停显示完整内容
   - 最大显示长度：50字符
   - **点击功能**：点击产品标题可直接跳转到产品详情页

2. **昨日销量** (yesterdaySales)
   - 显示昨日销售数量
   - 格式：数字 + "件"
   - 无数据时显示："-"

3. **价格增长百分比** (priceGrowthPercent)
   - 计算价格增长百分比
   - 格式：+X.X% 或 -X.X%
   - 正数显示绿色，负数显示红色
   - 无数据时显示："-"

4. **采集日期** (collectTime)
   - 显示产品采集的时间
   - 格式：YYYY-MM-DD HH:mm
   - 相对时间显示：X天前、X小时前

### 排序规则

- **默认排序**：按采集时间倒序（最近采集的在最上面）
- **支持排序**：点击列标题可切换升序/降序
- **多列排序**：支持多列组合排序

### 列表优化

- **移除操作列**：简化界面，移除右侧操作列
- **标题点击**：产品标题支持点击跳转到详情页
- **悬停效果**：鼠标悬停时高亮显示当前行

## 数据刷新机制

### 自动刷新

1. **进入页面时**：立即刷新一次
2. **定时刷新**：每5秒自动刷新一次
3. **刷新状态**：显示刷新进度和最后更新时间

### 手动刷新

- **移除刷新按钮**：简化界面，移除右上角刷新按钮
- **下拉刷新**：支持下拉手势刷新（移动端）
- **快捷键**：F5或Ctrl+R刷新

## 交互功能

### 列表操作

1. **行悬停**：高亮显示当前行
2. **标题点击**：点击产品标题跳转到产品详情页
3. **Tab管理**：每个产品详情页都有独立的Tab

### 产品详情Tab系统

1. **独立Tab**：每个产品详情都有独立的Tab
2. **Tab区分**：根据商品ID区分不同的产品Tab
3. **Tab切换**：支持在不同产品详情间快速切换
4. **数据加载**：切换Tab时自动重新加载对应产品数据

### 搜索和筛选

1. **搜索框**：按产品标题搜索（计划功能）
2. **筛选器**：
   - 按采集日期范围筛选（计划功能）
   - 按销量范围筛选（计划功能）
   - 按价格增长范围筛选（计划功能）
3. **高级筛选**：多条件组合筛选（计划功能）

### 数据导出

1. **导出格式**：CSV、Excel、JSON（计划功能）
2. **导出范围**：当前页、选中项、全部数据（计划功能）
3. **导出字段**：可自定义导出字段（计划功能）

## 技术实现

### 数据源

- **数据路径**：`data/goods-library/`
- **文件结构**：每个产品一个文件夹
- **数据文件**：`product.json`、`monitoring.json`、`media.json`
- **API接口**：通过 `http://localhost:3001/api/products` 获取产品列表
- **数据管理**：使用 `ProductDataManager` 类统一管理产品数据

### Tab系统实现

#### Tab管理类
```javascript
class TabManager {
    // 根据页面类型和特定参数查找Tab（用于产品详情等需要区分不同实例的页面）
    findTabByPageTypeAndParam(pageType, paramKey, paramValue) {
        return this.tabs.find(tab => 
            tab.pageType === pageType && 
            tab.pageData && 
            tab.pageData[paramKey] === paramValue
        );
    }
}
```

#### 产品详情Tab创建
```javascript
// 打开产品详情Tab
openProductDetailTab(product) {
    // 检查是否已存在该产品的详情Tab（根据商品ID查找）
    const existingTab = this.tabManager.findTabByPageTypeAndParam('productDetail', 'productId', product.goodsId);
    if (existingTab) {
        // 如果存在，切换到该Tab并更新数据
        this.tabManager.setActiveTab(existingTab.id);
        this.tabManager.renderTabs();
        this.loadProductDetailData(product);
    } else {
        // 如果不存在，创建新Tab
        const pageData = {
            type: 'productDetail',
            title: `产品详情 - ${product.goodsCat3 || product.goodsTitleEn || product.goodsId}`,
            productId: product.goodsId  // 关键：保存商品ID用于区分
        };
        this.tabManager.addTab(pageData);
        this.loadProductDetailData(product);
    }
}
```

### 性能优化

1. **Tab数据管理**：每个产品详情Tab独立管理数据
2. **懒加载**：图片和媒体文件懒加载
3. **缓存机制**：数据缓存和增量更新
4. **防抖处理**：搜索和筛选防抖（计划功能）
5. **分页加载**：使用 `Pagination` 组件实现分页功能
6. **数据排序**：支持按采集时间、销量、价格等多字段排序
7. **分类筛选**：支持按产品分类进行筛选

### 错误处理

1. **网络错误**：显示重试按钮
2. **数据错误**：显示错误提示
3. **加载失败**：显示加载失败状态
4. **空数据**：显示空状态提示
5. **Tab错误**：Tab切换失败时的错误处理

## 响应式设计

### 桌面端 (≥1024px)
- 显示所有字段
- 支持多列排序
- 完整的分页控件

### 平板端 (768px-1023px)
- 隐藏部分次要字段
- 简化分页控件
- 优化触摸交互

### 移动端 (<768px)
- 卡片式布局
- 滑动操作
- 简化界面元素

## 状态管理

### 加载状态
- 初始加载
- 刷新加载
- 分页加载
- 搜索加载

### 错误状态
- 网络错误
- 数据错误
- 权限错误
- 服务器错误

### 空状态
- 无数据
- 搜索无结果
- 筛选无结果

## 用户体验

### 视觉反馈
- 加载动画
- 悬停效果
- 点击反馈
- 状态指示

### 操作反馈
- 成功提示
- 错误提示
- 操作确认
- 进度显示

### 性能体验
- 快速响应
- 流畅滚动
- 即时搜索
- 平滑动画
